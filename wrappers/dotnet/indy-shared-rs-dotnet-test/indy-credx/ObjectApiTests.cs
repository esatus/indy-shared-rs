using FluentAssertions;
using indy_shared_rs_dotnet;
using indy_shared_rs_dotnet.indy_credx;
using indy_shared_rs_dotnet.Models;
using Newtonsoft.Json;
using NUnit.Framework;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace indy_shared_rs_dotnet_test.indy_credx
{
    internal class ObjectApiTests
    {
        #region Tests for GetTypeName
        [Test, TestCase(TestName = "")]
        public async Task GetTypeNameWorks()
        {
            //Arrange

            //Act

            //Assert
        }
        #endregion

        #region Tests for FreeObject
        [Test, TestCase(TestName = "")]
        public async Task FreeObjectWorks()
        {
            //Arrange

            //Act

            //Assert
        }

        [Test, TestCase(TestName = "FreeObject() throws SharedRsException if object handle is null.")]
        public async Task FreeObjectThrowsException()
        {
            //Arrange

            //Act

            //Assert
        }
        #endregion

        #region Tests for ToJson
        [Test, TestCase(TestName = "ToJson() converts an object handle to a correct json.")]
        public async Task ToJsonWorks()
        {
            //Arrange
            string expected = "{\"ver\":\"1.0\"," +
                "\"id\":\"NcYxiDXkpYi6ov5FcYDi1e: 3:CL: NcYxiDXkpYi6ov5FcYDi1e: 2:gvt: 1.0:tag\"," +
                "\"schemaId\":\"NcYxiDXkpYi6ov5FcYDi1e: 2:gvt: 1.0\"," +
                "\"type\":\"CL\"," +
                "\"tag\":\"tag\"," +
                "\"value\":{" +
                    "\"primary\":{" +
                        "\"n\":\"98888237517230330586210415259026956801495058522934262433151031092752353984335380758780233377010837503893603327824679729868809369756070401670104708890388387760820291738962429518176552896072820661920793858124321362288479056478448769855575217387535034743771831259255478137471110137387855170969246073749409670318149037198534862645677972636213004240630607408477653662347625991591630498635901123006782246995366767071039558658709297631652744628983954755540189133630280251746722076163505496059849053578011824116361696698462791294964163283734238146743242960775080300932909989320608493088352332751361327701084676126807249088353\"," +
                        "\"s\":\"59903306952170989244022634190275314974952681324619995608363201856955326883116884801226727976560775552953590732111176997746059386425092488209058101518620327544187959882172212816142897171667613632676693764720796084459364956915675253043375216742160404628245740715005378184241405724497137307002201986919504661943606530462745370690202744189505266021497452492993566361820623532346457924575837090148307075296315701169311182171415729466173052329746709489570340274032772361716850374689108784796635688006454762495994664066930130980200396360857345436730076392355916327128750074794762332884686702855543790220546884971991498041022\"," +
                        "\"r\":{" +
                            "\"sex\":\"47685340074944716326960951289698651322901305190410102807021687915267158922007682763917116919603173800937280830402406275278498945162946719915378765035610244686140796412450100676993124148373418818893745793692458850343523890028961315786445740827456498581843627180861475802592061118857766808748882736908641147928890376959043662271414406266442877910175144114801104639523270634296363085890406868168586105142407656133531100229836923388475876655603245204768709209843195686264599531733764648485500719509139554214102418026129215100089767970010300273754540012879463019835833082777479065161473789904006827522040745284796291932886\"," +
                            "\"age\":\"90999521819313205946097447190764390256038785071557369261762292470779792178865809730030172789435869278995619718233750200610430231601043512934762504624079651528058162426489823682000570376368689229455953087410137571007865502418067391516568012441393334036009753317530456320758587083413643916481827608351305552623344374713694554814108878585777451288414420276217689909261686057012915803784655737210583053375548574961526282911778914973390061061820136771920371718933941055453057976581342039075331524833599684671742396216842301042789206540687807405300451235826013040039762874270471319427479575657798506920383643560054926659893\"," +
                            "\"master_secret\":\"7053911397846824536198184566864482234037331338113403667431434833665172285313977387349866301285854390530664171975875540981500514186778051883553092307707106423643786952906491571894946711097837931489271251056951629007078000891907566548461993476110691552781647497705188183977977902819236201842323066955725918144314157442482494918918712957994220372628742335162383797396675672904551319791443613796120170594891564597793016826327051735793677353587781365762934936289569450252844816700113216383357738281270673054716106630745120878719495083653774452619718796857910861951570542947484492596747927498052549026816215710667864612046\"," +
                            "\"gender\":\"45879007601444249633703234300725674925123355593515129067275368297383014751028069341630273558142544977834155794031213752827117358825161701406708583718117053234654779687085395224009508757632578880846640784508447650351566435710918191942826238079625317191863812770706100530841224913938917834341858911678034945438232753666670442006329893516350445769927538783247814124614746523003578782939592068070063730594297872774518130951625641152884375606318836519063897142115627324662979759986724580913173065404724210687324599773534035410982164608555696658039681903384483635315050465515581183211041718440218076018060474253254796164410\"" +
                            "}," +
                        "\"rctxt\":\"19428596804998851493037624735056729730085827131935699331418589397517649912553972897742928240800027677273105590696198413053693085227359441448092436950098444222938752744238544548461562318102288525354765178246179033027052904393051115689553924406511951839376798907967053157671077870082419111881368642799166289978429901013019967513357607380050363750116067599258438367435732655639677446318352585163659355675338935407040136495081593346007606784266405904055086792439708067846494929129865820149052321909074637162051817464914355710822131983272806489194885793658307750377009771214640556449543122053420577752406624519452267467259\"," +
                        "\"z\":\"57242936590389633762882735094721259548235238384558823533171525405502857001822966317613291392955567255720865420742925245178320625226101055738639465394045028652978189404243999968031569740529295869666762056457573656003709810836414779288364078174991825103875761494381090288396022901657633296609873845588473530613558571421627619681847461660436538958711070484783175271552512369386415498837747954468013122358936559393859894088447919681324405892709118622248671107970066733022394167229578043345317995658138018211531317006489902753147493275189528614959107078531677844348600680078794599527012387384421498474814846832954319549739\"" +
                        "}," +
                        "\"revocation\":{" +
                            "\"g\":\"1 07CE88BD4D51BAC72A48E06369BD0579154A7DAEDDBAA7E726D4BEA83AE74C7D 1 07424DC8B12944A3975CA9647977B93502724073FD9C8ABA0890B00F5C377758 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"g_dash\":\"1 0A29EA9838F9E5FA431A066082291A6BCE26342F33C7C94E04A47868F17DAE93 1 10CAF05B5DCF584FFB622681EFD88BDED9CBCE12E85A9932F9900822698FC5A5 1 025CB91844A5EDC25518FC8370370021E5DC7A9DFD22575F4CE57A4388137D1F 1 20A1ACE1B46364617BB6AB2FA81BB3D14B8732007DA13A9AA4B83C32AC5470D3 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8 1 0000000000000000000000000000000000000000000000000000000000000000\"," +
                            "\"h\":\"1 13633779F0B6582220A65AF735975D54FCDA069FAE1E37D21BC725F81B6E3865 1 1587851EC474414A7652BEEDE9ACFE0CEB5A8147587A2ECB244E54C5CC22F2D1 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"h0\":\"1 1C7049C371BE1F25FFEC66FFB4E2C02F72420B25BBA5F8F65F4D2CC6927C2600 1 22509B8DA9E5E28498A9B3A4E8022CEA9C2129EA33AD3E2C0F069CF6F5FED178 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"h1\":\"1 25168E3B4AAE134AAB4078DEDB1A620E7A22D4831E0BC857C1F6D39AC6049D15 1 030397474191A05BB539AED601A733E71C89647BE125F9A1A46C3D2B84169001 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"h2\":\"1 024673228FE9F7FCF43CF31C0C5A61C63C5737DE273DCF855AD63C3BF7E0DF35 1 1FB421C0AA1BEAB114CFA3C2BD9AD31F7292E7B2D46613CFDCBDD6A48403B228 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"htilde\":\"1 030281E2B343D12A758C6C19271A97878CA3E5D6A81AFD5860C2CF0245F2DFA3 1 1E49FC1C66DD089AB70C74AF80C74476DF49119E3405F3A50B0F312A44F509D3 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"h_cap\":\"1 0C0A978152E5426D7D9AEBE7C86193B895A0A8C374082389557874DC0354009F 1 118B37CD46438C0AAC8FEB1D617C48D723FFAE40DD9284F36908D0FD651A91CA 1 0734A87011C580E98071D3BE9A2A296FF795C0D5A07EADE62B90A2369D4D8265 1 1753469AE17695C0B2B7971CA4583101E96534C9AEAB000BAAD929999FDD729A 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8 1 0000000000000000000000000000000000000000000000000000000000000000\"," +
                            "\"u\":\"1 0E97513CC922E3C71F7BA2D2A6E0E5397E237085BE8CDB9BFA0BEFB1CEABE349 1 0A1E7438E370A88719ECA74454531DFF71EB816CE1D40B60969EF5445B04A844 1 1E79476661DB246F71C784B2811F3F860D61E58B4CA2492BEB4C5137772D9D55 1 17F371DC37FF3F9E60D705BB8B881E7CC41AAE4D3BD76AC44D6EC0C5C8B38D47 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8 1 0000000000000000000000000000000000000000000000000000000000000000\"," +
                            "\"pk\":\"1 0B19DD648952DBE2035B48707B7062C016A8D51596C484D01E918A6A093BB2AE 1 0B180EC9C72F17969BAC57D6D1600BD714A35B206BDBFFBBBDC5F01BF8A5470E 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8\"," +
                            "\"y\":\"1 0F9EDDF08718D0472BEFC07B97B036DEDAA92B7072234D26F5E8C3B50807A074 1 00FE8B7CF885349BDF3AF0D342F9A2833A72B8E6E16504A302E539D9F7C4C619 1 0741D6B38449C6622E9AD506984AB3EC6347611B059CC0A7BB5A861D0FA2D203 1 181A18BACED9DF13016B6FDE08EC6C1AB7C7951AF8D7099D2F17A37F6C1015FF 2 095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8 1 0000000000000000000000000000000000000000000000000000000000000000\""+
                        "}"+
                    "}"+
                "}";
            List<string> attrNames = new() { "gender", "age", "sex" };
            string issuerDid = "NcYxiDXkpYi6ov5FcYDi1e";
            string schemaName = "gvt";
            string schemaVersion = "1.0";
            Schema schemaObject = await SchemaApi.CreateSchemaAsync(issuerDid, schemaName, schemaVersion, attrNames, 0);
            (CredentialDefinition credDefObject, _, _) =
                await CredentialDefinitionApi.CreateCredentialDefinitionAsync(issuerDid, schemaObject, "tag", Consts.SIGNATURE_TYPE, 1);

            //Act
            string actual = await ObjectApi.ToJson(credDefObject.Handle);

            //Assert
            actual.Should().BeEquivalentTo(expected);
        }
        #endregion
    }
}
